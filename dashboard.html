<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… - Ø®ÙˆØ§Ø±Ø²</title>
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@300;400;500;700;800;900&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: { extend: { fontFamily: { tajawal: ['Tajawal', 'sans-serif'] } } }
        }
    </script>
    <style>
        * { font-family: 'Tajawal', sans-serif; }
        body {
            background: linear-gradient(135deg, #0f0a2e 0%, #1a1145 30%, #1e1550 50%, #151040 70%, #0d0825 100%);
            min-height: 100vh;
        }

        /* Cards */
        .card-glass {
            background: rgba(255,255,255,0.05);
            border: 1px solid rgba(255,255,255,0.08);
            backdrop-filter: blur(20px);
        }

        /* Welcome Banner */
        .welcome-banner {
            background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 30%, #a855f7 60%, #c084fc 100%);
            position: relative;
            overflow: hidden;
        }
        .welcome-banner::before {
            content: '';
            position: absolute;
            top: -50%; right: -20%;
            width: 300px; height: 300px;
            background: radial-gradient(circle, rgba(255,255,255,0.15) 0%, transparent 70%);
            border-radius: 50%;
        }
        .welcome-banner::after {
            content: '';
            position: absolute;
            bottom: -30%; left: -10%;
            width: 200px; height: 200px;
            background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);
            border-radius: 50%;
        }

        /* Stat Cards */
        .stat-card {
            background: rgba(255,255,255,0.04);
            border: 1px solid rgba(255,255,255,0.06);
            backdrop-filter: blur(10px);
            transition: all 0.3s ease;
        }
        .stat-card:hover {
            background: rgba(255,255,255,0.08);
            border-color: rgba(255,255,255,0.12);
            transform: translateY(-2px);
        }

        /* Action Buttons */
        .action-card {
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        .action-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 12px 40px rgba(0,0,0,0.3);
        }
        .action-card::before {
            content: '';
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            background: linear-gradient(135deg, rgba(255,255,255,0.1) 0%, transparent 50%);
            pointer-events: none;
        }

        /* Progress Bar */
        .progress-track {
            background: rgba(255,255,255,0.08);
            border-radius: 999px;
            overflow: hidden;
        }
        .progress-fill {
            background: linear-gradient(90deg, #8b5cf6, #6366f1, #4f46e5);
            border-radius: 999px;
            transition: width 1s ease;
            position: relative;
        }
        .progress-fill::after {
            content: '';
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
            animation: shimmer 2s infinite;
        }
        @keyframes shimmer {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }

        /* Animations */
        @keyframes fadeUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-in { animation: fadeUp 0.5s ease forwards; }
        .delay-1 { animation-delay: 0.05s; opacity: 0; }
        .delay-2 { animation-delay: 0.1s; opacity: 0; }
        .delay-3 { animation-delay: 0.15s; opacity: 0; }
        .delay-4 { animation-delay: 0.2s; opacity: 0; }
        .delay-5 { animation-delay: 0.25s; opacity: 0; }
        .delay-6 { animation-delay: 0.3s; opacity: 0; }

        /* Marquee */
        .marquee-container { overflow: hidden; white-space: nowrap; }
        .marquee-text { display: inline-block; animation: marquee 25s linear infinite; }
        @keyframes marquee { 0% { transform: translateX(-100%); } 100% { transform: translateX(100%); } }

        /* Logo */
        @keyframes logoPulse {
            0%, 100% { filter: drop-shadow(0 0 8px rgba(139,92,246,0.4)); }
            50% { filter: drop-shadow(0 0 16px rgba(139,92,246,0.7)); }
        }
        .logo-glow { animation: logoPulse 3s ease-in-out infinite; }

        /* Avatar */
        .avatar-ring {
            background: linear-gradient(135deg, #8b5cf6, #6366f1);
            padding: 2px;
            border-radius: 50%;
        }

        /* Counter Animation */
        @keyframes countUp {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
    /* Khawariz Logo */
.kh-logo-box{position:relative;display:inline-flex;flex-direction:column;align-items:center;padding:7px 22px 6px;border:1.5px solid rgba(139,92,246,0.25);border-radius:6px;background:rgba(15,10,46,0.3)}
.kh-corner-tl,.kh-corner-br{position:absolute;width:8px;height:8px}
.kh-corner-tl{top:-1.5px;left:-1.5px;border-top:2px solid #a855f7;border-left:2px solid #a855f7;border-radius:2px 0 0 0}
.kh-corner-br{bottom:-1.5px;right:-1.5px;border-bottom:2px solid #a855f7;border-right:2px solid #a855f7;border-radius:0 0 2px 0}
.kh-logo-name{font-size:18px;font-weight:900;line-height:1;color:white}
.kh-logo-name .kha{background:linear-gradient(135deg,#c084fc,#a855f7);-webkit-background-clip:text;-webkit-text-fill-color:transparent}
.kh-logo-line{height:1.5px;margin-top:3px;width:100%;background:linear-gradient(90deg,#7c3aed,#a855f7,rgba(168,85,247,0.2));border-radius:1px}
.kh-logo-en{font-size:7px;letter-spacing:2.5px;color:rgba(168,85,247,0.45);font-weight:700;margin-top:2px}
</style>
</head>
<body class="font-tajawal text-white">

    <!-- Top Banner -->
    <div class="bg-gradient-to-l from-purple-900/60 via-indigo-900/60 to-purple-900/60 border-b border-purple-500/20">
        <div class="marquee-container py-2.5">
            <span class="marquee-text text-sm text-purple-200/90">
                âœ¨ Ù…Ù†ØµØ© Ø®ÙˆØ§Ø±Ø² ØªØªØ·ÙˆØ± ÙŠÙˆÙ…ÙŠØ§Ù‹ â€” Ù†Ø¶ÙŠÙ Ø£Ø³Ø¦Ù„Ø© Ø¬Ø¯ÙŠØ¯Ø© ÙˆÙ†Ø­Ø³Ù‘Ù† Ø§Ù„ØªØ¬Ø±Ø¨Ø© Ø¨Ø§Ø³ØªÙ…Ø±Ø§Ø± Ù„ØªÙ‚Ø¯ÙŠÙ… ØªØ¯Ø±ÙŠØ¨ Ø£Ø¯Ù‚ ÙˆØ£Ù‚ÙˆÙ‰
            </span>
        </div>
    </div>

    <!-- Header -->
    <header class="animate-in delay-1">
        <div class="max-w-4xl mx-auto px-4 py-4">
            <div class="flex justify-between items-center">
                <!-- Logo + Tagline -->
                <div class="flex items-center gap-3">
                    <span class="text-3xl logo-glow">ğŸ“</span>
                    <div>
                        <h1 class="text-2xl font-black bg-gradient-to-l from-purple-300 to-indigo-300 bg-clip-text text-transparent leading-tight">Ø®ÙˆØ§Ø±Ø²</h1>
                        <p class="text-[10px] text-purple-200/70 font-medium -mt-0.5">Ø§Ù„Ù‚Ø¯Ø±Ø§Øª Â· Ø§Ù„ØªØ­ØµÙŠÙ„ÙŠ Â· Ù‚ÙŠØ§Ø³</p>
                    </div>
                </div>
                <!-- User -->
                <button onclick="window.location.href='profile.html'" class="flex items-center gap-3 hover:opacity-80 transition group">
                    <div class="text-right">
                        <span class="font-bold text-white text-sm block" id="userName">...</span>
                        <p class="text-xs" id="subscriptionLabel"><span class="text-purple-300/60">...</span></p>
                    </div>
                    <div class="avatar-ring">
                        <div class="w-10 h-10 bg-indigo-900 rounded-full flex items-center justify-center text-xl group-hover:scale-105 transition">
                            <span id="userAvatar">ğŸ‘¤</span>
                        </div>
                    </div>
                </button>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="max-w-4xl mx-auto px-4 pb-12">

        <!-- Welcome Card -->
        <div class="animate-in delay-2 welcome-banner rounded-3xl p-6 mb-5 shadow-2xl relative z-10">
            <h2 class="text-2xl sm:text-3xl font-black text-white mb-1 relative z-10">
                Ø£Ù‡Ù„Ø§Ù‹ <span id="displayName">...</span>
            </h2>
            <p class="text-white/80 text-sm sm:text-base font-medium relative z-10" id="motivationalQuote">Ø«Ù‚ Ø¨Ù†ÙØ³ÙƒØŒ Ø£Ù†Øª Ø£Ù‚ÙˆÙ‰ Ù…Ù…Ø§ ØªØªØ®ÙŠÙ„</p>
        </div>

        <!-- Stats Grid -->
        <div class="grid grid-cols-2 md:grid-cols-4 gap-3 mb-5">
            <div class="animate-in delay-3 stat-card rounded-2xl p-4 text-center">
                <span class="text-2xl mb-2 block">ğŸ“</span>
                <p class="text-purple-300/50 text-xs mb-1">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø£Ø³Ø¦Ù„Ø©</p>
                <p class="text-2xl sm:text-3xl font-black text-white" id="totalQuestions">0</p>
            </div>
            <div class="animate-in delay-3 stat-card rounded-2xl p-4 text-center">
                <span class="text-2xl mb-2 block">âœ…</span>
                <p class="text-purple-300/50 text-xs mb-1">Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø§Øª Ø§Ù„ØµØ­ÙŠØ­Ø©</p>
                <p class="text-2xl sm:text-3xl font-black text-green-400" id="correctAnswers">0</p>
            </div>
            <div class="animate-in delay-4 stat-card rounded-2xl p-4 text-center">
                <span class="text-2xl mb-2 block">âŒ</span>
                <p class="text-purple-300/50 text-xs mb-1">Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø§Øª Ø§Ù„Ø®Ø§Ø·Ø¦Ø©</p>
                <p class="text-2xl sm:text-3xl font-black text-red-400" id="wrongAnswers">0</p>
            </div>
            <div class="animate-in delay-4 stat-card rounded-2xl p-4 text-center">
                <span class="text-2xl mb-2 block">ğŸ¯</span>
                <p class="text-purple-300/50 text-xs mb-1">Ù†Ø³Ø¨Ø© Ø§Ù„Ù†Ø¬Ø§Ø­</p>
                <p class="text-2xl sm:text-3xl font-black text-purple-300" id="successRate">0%</p>
            </div>
        </div>

        <!-- Weekly Progress -->
        <div class="animate-in delay-5 card-glass rounded-2xl p-5 mb-5">
            <div class="flex justify-between items-center mb-3">
                <h3 class="text-base font-bold">ØªÙ‚Ø¯Ù…Ùƒ Ù‡Ø°Ø§ Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹</h3>
                <span class="text-purple-300/50 text-sm"><span id="weeklyCount">0</span> Ø³Ø¤Ø§Ù„</span>
            </div>
            <div class="progress-track h-3">
                <div id="progressBar" class="progress-fill h-3" style="width: 0%"></div>
            </div>
        </div>

        <!-- Action Buttons -->
        <div class="grid grid-cols-1 sm:grid-cols-3 gap-3">
            <a href="select-section.html" class="animate-in delay-5 action-card block bg-gradient-to-br from-indigo-600 to-purple-700 text-white p-5 rounded-2xl shadow-lg">
                <div class="flex items-center gap-3 relative z-10">
                    <div class="bg-white/15 p-3 rounded-xl flex-shrink-0">
                        <svg class="w-7 h-7" fill="currentColor" viewBox="0 0 20 20"><path d="M10.894 2.553a1 1 0 00-1.788 0l-7 14a1 1 0 001.169 1.409l5-1.429A1 1 0 009 15.571V11a1 1 0 112 0v4.571a1 1 0 00.725.962l5 1.428a1 1 0 001.17-1.408l-7-14z"/></svg>
                    </div>
                    <div class="text-right flex-1">
                        <h3 class="text-lg font-bold">Ø§Ø¨Ø¯Ø£ Ø§Ù„ØªØ¯Ø±ÙŠØ¨</h3>
                        <p class="text-sm text-white/60">Ø­Ù„ Ø£Ø³Ø¦Ù„Ø© Ø¬Ø¯ÙŠØ¯Ø©</p>
                    </div>
                </div>
            </a>
            <a href="stats.html" class="animate-in delay-6 action-card block bg-gradient-to-br from-emerald-600 to-teal-700 text-white p-5 rounded-2xl shadow-lg">
                <div class="flex items-center gap-3 relative z-10">
                    <div class="bg-white/15 p-3 rounded-xl flex-shrink-0">
                        <svg class="w-7 h-7" fill="currentColor" viewBox="0 0 20 20"><path d="M2 11a1 1 0 011-1h2a1 1 0 011 1v5a1 1 0 01-1 1H3a1 1 0 01-1-1v-5zM8 7a1 1 0 011-1h2a1 1 0 011 1v9a1 1 0 01-1 1H9a1 1 0 01-1-1V7zM14 4a1 1 0 011-1h2a1 1 0 011 1v12a1 1 0 01-1 1h-2a1 1 0 01-1-1V4z"/></svg>
                    </div>
                    <div class="text-right flex-1">
                        <h3 class="text-lg font-bold">Ø¥Ø­ØµØ§Ø¦ÙŠØ§ØªÙŠ</h3>
                        <p class="text-sm text-white/60">ØªØ­Ù„ÙŠÙ„ ØªÙØµÙŠÙ„ÙŠ Ù„Ø£Ø¯Ø§Ø¦Ùƒ</p>
                    </div>
                </div>
            </a>
            <a href="mistakes.html" class="animate-in delay-6 action-card block bg-gradient-to-br from-rose-600 to-pink-700 text-white p-5 rounded-2xl shadow-lg">
                <div class="flex items-center gap-3 relative z-10">
                    <div class="bg-white/15 p-3 rounded-xl flex-shrink-0">
                        <svg class="w-7 h-7" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z" clip-rule="evenodd"/></svg>
                    </div>
                    <div class="text-right flex-1">
                        <h3 class="text-lg font-bold">Ø±Ø§Ø¬Ø¹ Ø£Ø®Ø·Ø§Ø¦Ùƒ</h3>
                        <p class="text-sm text-white/60">ØªØ¹Ù„Ù… Ù…Ù† Ø§Ù„Ø£Ø®Ø·Ø§Ø¡ Ø§Ù„Ø³Ø§Ø¨Ù‚Ø©</p>
                    </div>
                </div>
            </a>
        </div>

        <!-- Upgrade Banner (free users only) -->
        <div id="upgradeBanner" class="hidden animate-in delay-6 mt-5 rounded-2xl p-5 text-center relative overflow-hidden" style="background: linear-gradient(135deg, rgba(99,102,241,0.15), rgba(168,85,247,0.15)); border: 1px solid rgba(139,92,246,0.2);">
            <h3 class="text-base font-bold mb-1">ğŸš€ Ø·ÙˆÙ‘Ø± ØªØ¬Ø±Ø¨ØªÙƒ</h3>
            <p class="text-purple-300/50 text-xs mb-3">Ø§Ø´ØªØ±Ùƒ Ø§Ù„Ø¢Ù† ÙˆØ§Ø­ØµÙ„ Ø¹Ù„Ù‰ Ø£Ø³Ø¦Ù„Ø© ØºÙŠØ± Ù…Ø­Ø¯ÙˆØ¯Ø© ÙˆØ¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ù…ØªÙ‚Ø¯Ù…Ø©</p>
            <a href="pricing.html" class="inline-block px-6 py-2 bg-gradient-to-r from-indigo-600 to-purple-600 text-white rounded-xl text-sm font-bold hover:shadow-lg hover:shadow-purple-500/25 transition">Ø´ÙˆÙ Ø§Ù„Ø¨Ø§Ù‚Ø§Øª âœ¨</a>
        </div>

        <!-- Footer Links -->
        <div class="mt-8 flex items-center justify-center gap-4 text-xs">
            <a href="pricing.html" class="text-purple-200/60 hover:text-purple-300/60 transition">Ø§Ù„Ø¨Ø§Ù‚Ø§Øª</a>
            <span class="text-purple-300/10">|</span>
            <a href="privacy.html" class="text-purple-200/60 hover:text-purple-300/60 transition">Ø§Ù„Ø®ØµÙˆØµÙŠØ©</a>
            <span class="text-purple-300/10">|</span>
            <a href="terms.html" class="text-purple-200/60 hover:text-purple-300/60 transition">Ø§Ù„Ø´Ø±ÙˆØ·</a>
        </div>

        <p class="text-center text-purple-200/50 text-xs mt-4">Ø®ÙˆØ§Ø±Ø² v1.0</p>
    </main>

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script>
        const sb = window.supabase.createClient(
            'https://czzcmbxejxbotjemyuqf.supabase.co',
            'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImN6emNtYnhlanhib3RqZW15dXFmIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzAxNzQ0ODEsImV4cCI6MjA4NTc1MDQ4MX0.xDfG1qsDZGyUrpL44JfqOtk57dVsLaMsvIzJz1KgiR0'
        );

        let currentUser = null;

        async function checkAuth() {
            try {
                const { data: { session }, error } = await sb.auth.getSession();
                if (error || !session) {
                    window.location.href = 'login.html';
                    return false;
                }
                currentUser = session.user;

                // Get name from profiles (full_name column)
                let displayName = '';
                let subType = 'free';
                try {
                    const { data: profile } = await sb
                        .from('profiles')
                        .select('full_name, avatar_emoji, subscription_type')
                        .eq('id', currentUser.id)
                        .single();

                    if (profile && profile.full_name) {
                        displayName = profile.full_name;
                    }
                    if (profile && profile.avatar_emoji) {
                        document.getElementById('userAvatar').textContent = profile.avatar_emoji;
                    }
                    if (profile && profile.subscription_type) {
                        subType = profile.subscription_type;
                    }
                } catch(e) {}

                // Subscription label
                const subEl = document.getElementById('subscriptionLabel');
                if (subType === 'monthly') {
                    subEl.innerHTML = '<span class="text-indigo-300">Ù…Ø´ØªØ±Ùƒ Ø´Ù‡Ø±ÙŠ ğŸ”¥</span>';
                } else if (subType === 'yearly') {
                    subEl.innerHTML = '<span class="text-emerald-300">Ù…Ø´ØªØ±Ùƒ Ø³Ù†ÙˆÙŠ ğŸ’</span>';
                } else {
                    subEl.innerHTML = '<a href="pricing.html" class="text-yellow-300/80 hover:text-yellow-200 transition">ØªØ¬Ø±Ø¨Ø© Ù…Ø¬Ø§Ù†ÙŠØ© â€” <span class="underline">Ø§Ø´ØªØ±Ùƒ</span> âœ¨</a>';
                }

                // Fallback: user_metadata
                if (!displayName && currentUser.user_metadata && currentUser.user_metadata.name) {
                    displayName = currentUser.user_metadata.name;
                }

                // Last fallback: email
                if (!displayName) {
                    displayName = currentUser.email ? currentUser.email.split('@')[0] : '';
                }

                // First name only for welcome
                const firstName = displayName.split(' ')[0];
                document.getElementById('userName').textContent = displayName;
                document.getElementById('displayName').textContent = firstName;

                return true;
            } catch (err) {
                console.error('Auth error:', err);
                window.location.href = 'login.html';
                return false;
            }
        }

        async function loadStats() {
            const quotes = [
                'ÙƒÙ„ Ø³Ø¤Ø§Ù„ ØªØ­Ù„Ù‡ Ø®Ø·ÙˆØ© Ø£Ù‚Ø±Ø¨ Ù„Ø­Ù„Ù…Ùƒ',
                'Ø§Ù„Ù†Ø¬Ø§Ø­ ÙŠØ­ØªØ§Ø¬ Ù„Ù„Ø¬Ù‡Ø¯ ÙˆØ§Ù„Ø¥ØµØ±Ø§Ø±',
                'Ø£Ù†Øª Ù‚Ø§Ø¯Ø± Ø¹Ù„Ù‰ ØªØ­Ù‚ÙŠÙ‚ Ø£Ù‡Ø¯Ø§ÙÙƒ',
                'Ø«Ù‚ Ø¨Ù†ÙØ³ÙƒØŒ Ø£Ù†Øª Ø£Ù‚ÙˆÙ‰ Ù…Ù…Ø§ ØªØªØ®ÙŠÙ„',
                'ÙƒÙ„ ÙŠÙˆÙ… ØªØ¯Ø±ÙŠØ¨ØŒ ÙƒÙ„ ÙŠÙˆÙ… ØªØ·ÙˆØ±',
                'Ø­Ù„Ù…Ùƒ Ù‚Ø±ÙŠØ¨ØŒ Ø§Ø³ØªÙ…Ø± ÙˆØ§Ø¬ØªÙ‡Ø¯'
            ];
            document.getElementById('motivationalQuote').textContent = quotes[Math.floor(Math.random() * quotes.length)];

            try {
                const { data: allAttempts, error } = await sb
                    .from('attempts')
                    .select('is_correct, answered_at')
                    .eq('user_id', currentUser.id);

                if (error && error.code !== 'PGRST116') return;

                const total = allAttempts ? allAttempts.length : 0;
                const correct = allAttempts ? allAttempts.filter(a => a.is_correct).length : 0;
                const wrong = total - correct;
                const rate = total > 0 ? Math.round((correct / total) * 100) : 0;

                document.getElementById('totalQuestions').textContent = total;
                document.getElementById('correctAnswers').textContent = correct;
                document.getElementById('wrongAnswers').textContent = wrong;
                document.getElementById('successRate').textContent = rate + '%';

                const oneWeekAgo = new Date();
                oneWeekAgo.setDate(oneWeekAgo.getDate() - 7);
                const weekly = allAttempts ? allAttempts.filter(a => new Date(a.answered_at) > oneWeekAgo).length : 0;
                document.getElementById('weeklyCount').textContent = weekly;
                document.getElementById('progressBar').style.width = Math.min((weekly / 50) * 100, 100) + '%';
            } catch (err) {
                console.error('Stats error:', err);
            }
        }

        document.addEventListener('DOMContentLoaded', async function() {
            const ok = await checkAuth();
            if (!ok) return;
            await loadStats();
            // Show upgrade banner for free users
            const subLabel = document.getElementById('subscriptionLabel').textContent;
            if (subLabel.includes('Ù…Ø¬Ø§Ù†ÙŠØ©') || subLabel.includes('Ø§Ø´ØªØ±Ùƒ')) {
                document.getElementById('upgradeBanner').classList.remove('hidden');
            }
        });
    </script>
</body>
</html>
