<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù„ÙˆØ­Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© - Ù…Ø³Ø§Ø±ÙŠ</title>
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@300;400;500;700;800;900&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        *{font-family:'Tajawal',sans-serif}
        body{background:linear-gradient(135deg,#0f0a2e 0%,#1a1145 30%,#1e1550 50%,#151040 70%,#0d0825 100%);min-height:100vh}
        .glass{background:rgba(255,255,255,0.04);border:1px solid rgba(255,255,255,0.08);backdrop-filter:blur(20px);border-radius:1rem}
        .sidebar{background:rgba(255,255,255,0.03);border-left:1px solid rgba(255,255,255,0.06);min-height:100vh;width:220px;position:fixed;top:0;right:0;z-index:40;overflow-y:auto}
        .sidebar-link{display:flex;align-items:center;gap:10px;padding:10px 16px;border-radius:.75rem;font-size:.8rem;font-weight:600;color:rgba(196,181,253,0.5);transition:all .2s;cursor:pointer;margin:2px 8px}
        .sidebar-link:hover{background:rgba(255,255,255,0.05);color:rgba(196,181,253,0.8)}
        .sidebar-link.active{background:rgba(99,102,241,0.15);color:#a5b4fc;border:1px solid rgba(99,102,241,0.2)}
        .main-content{margin-right:220px;padding:20px;min-height:100vh}
        .input-dark{background:rgba(255,255,255,0.06);border:1px solid rgba(255,255,255,0.1);border-radius:.75rem;padding:.625rem .875rem;color:#fff;width:100%;font-size:.85rem;transition:all .2s}
        .input-dark:focus{outline:none;border-color:rgba(139,92,246,0.5);box-shadow:0 0 0 3px rgba(139,92,246,0.1)}
        .input-dark::placeholder{color:rgba(255,255,255,0.2)}
        .input-dark option{background:#1a1145;color:#fff}
        .btn-p{background:linear-gradient(135deg,#6366f1,#8b5cf6);padding:8px 20px;border-radius:.75rem;font-weight:700;font-size:.8rem;color:#fff;transition:all .2s;border:none;cursor:pointer}
        .btn-p:hover{box-shadow:0 8px 25px rgba(99,102,241,0.3);transform:translateY(-1px)}
        .btn-d{background:rgba(239,68,68,0.15);border:1px solid rgba(239,68,68,0.2);color:#f87171;padding:6px 14px;border-radius:.75rem;font-size:.75rem;font-weight:600;cursor:pointer;transition:all .2s}
        .btn-d:hover{background:rgba(239,68,68,0.25)}
        .btn-s{background:rgba(255,255,255,0.06);border:1px solid rgba(255,255,255,0.1);color:#c4b5fd;padding:6px 14px;border-radius:.75rem;font-size:.75rem;font-weight:600;cursor:pointer;transition:all .2s}
        .btn-s:hover{background:rgba(255,255,255,0.1)}
        .stat-card{transition:all .3s}.stat-card:hover{transform:translateY(-3px)}
        .table-row{border-bottom:1px solid rgba(255,255,255,0.04);transition:background .2s}
        .table-row:hover{background:rgba(255,255,255,0.03)}
        .badge{display:inline-block;padding:2px 10px;border-radius:999px;font-size:.7rem;font-weight:700}
        .badge-free{background:rgba(251,191,36,0.1);color:#fbbf24;border:1px solid rgba(251,191,36,0.2)}
        .badge-monthly{background:rgba(99,102,241,0.1);color:#818cf8;border:1px solid rgba(99,102,241,0.2)}
        .badge-yearly{background:rgba(16,185,129,0.1);color:#34d399;border:1px solid rgba(16,185,129,0.2)}
        .badge-admin{background:rgba(239,68,68,0.1);color:#f87171;border:1px solid rgba(239,68,68,0.2)}
        .tab-section{display:none}.tab-section.active{display:block}
        .toast{position:fixed;top:20px;left:50%;transform:translateX(-50%);padding:10px 24px;border-radius:12px;font-size:.85rem;font-weight:700;z-index:999;animation:slideD .4s ease}
        .toast-ok{background:linear-gradient(135deg,#10b981,#14b8a6);color:#fff}
        .toast-err{background:linear-gradient(135deg,#ef4444,#dc2626);color:#fff}
        @keyframes slideD{from{opacity:0;transform:translateX(-50%) translateY(-20px)}to{opacity:1;transform:translateX(-50%) translateY(0)}}
        .modal-bg{position:fixed;inset:0;background:rgba(0,0,0,0.6);backdrop-filter:blur(5px);z-index:50;display:flex;align-items:center;justify-content:center;padding:16px}
        .modal-box{background:linear-gradient(135deg,#1a1145,#1e1550);border:1px solid rgba(139,92,246,0.2);border-radius:1.25rem;padding:24px;width:100%;max-width:500px;max-height:85vh;overflow-y:auto}
        @media(max-width:768px){.sidebar{display:none}.main-content{margin-right:0}}
    </style>
</head>
<body class="text-white">
    <div id="toast" class="toast hidden"></div>

    <!-- Sidebar -->
    <aside class="sidebar">
        <div class="p-4 mb-2">
            <div class="flex items-center gap-2 mb-1">
                <span class="text-xl">ğŸ“</span>
                <span class="text-lg font-black bg-gradient-to-l from-purple-300 to-indigo-300 bg-clip-text text-transparent">Ù…Ø³Ø§Ø±ÙŠ</span>
            </div>
            <p class="text-[10px] text-purple-300/30">Ù„ÙˆØ­Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©</p>
        </div>

        <div class="sidebar-link active" onclick="switchTab('overview')">
            <span>ğŸ“Š</span><span>Ù†Ø¸Ø±Ø© Ø¹Ø§Ù…Ø©</span>
        </div>
        <div class="sidebar-link" onclick="switchTab('questions')">
            <span>ğŸ“</span><span>Ø§Ù„Ø£Ø³Ø¦Ù„Ø©</span>
        </div>
        <div class="sidebar-link" onclick="switchTab('users')">
            <span>ğŸ‘¥</span><span>Ø§Ù„Ø£Ø¹Ø¶Ø§Ø¡</span>
        </div>
        <div class="sidebar-link" onclick="switchTab('coupons')">
            <span>ğŸŸï¸</span><span>Ø§Ù„ÙƒÙˆØ¨ÙˆÙ†Ø§Øª</span>
        </div>
        <div class="sidebar-link" onclick="switchTab('finance')">
            <span>ğŸ’°</span><span>Ø§Ù„Ù…Ø§Ù„ÙŠØ©</span>
        </div>
        <div class="sidebar-link" onclick="switchTab('reports')">
            <span>ğŸš©</span><span>Ø§Ù„Ø¨Ù„Ø§ØºØ§Øª</span>
        </div>
        <div class="sidebar-link" onclick="switchTab('staff')">
            <span>ğŸ”‘</span><span>Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†</span>
        </div>
        <div class="sidebar-link" onclick="switchTab('settings')">
            <span>âš™ï¸</span><span>Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</span>
        </div>

        <div class="mt-auto p-4 border-t border-purple-500/10 mt-4">
            <button onclick="logout()" class="sidebar-link w-full" style="color:#f87171">
                <span>ğŸšª</span><span>ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬</span>
            </button>
        </div>
    </aside>

    <!-- Main -->
    <div class="main-content">

        <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â• Ù†Ø¸Ø±Ø© Ø¹Ø§Ù…Ø© â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
        <div id="tab-overview" class="tab-section active">
            <h2 class="text-xl font-black mb-5">ğŸ“Š Ù†Ø¸Ø±Ø© Ø¹Ø§Ù…Ø©</h2>
            <div class="grid grid-cols-2 lg:grid-cols-4 gap-3 mb-6">
                <div class="stat-card glass p-4 text-center">
                    <p class="text-purple-300/40 text-xs mb-1">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø£Ø³Ø¦Ù„Ø©</p>
                    <p class="text-2xl font-black text-indigo-400" id="ov-questions">-</p>
                </div>
                <div class="stat-card glass p-4 text-center">
                    <p class="text-purple-300/40 text-xs mb-1">Ø§Ù„Ø£Ø¹Ø¶Ø§Ø¡</p>
                    <p class="text-2xl font-black text-emerald-400" id="ov-users">-</p>
                </div>
                <div class="stat-card glass p-4 text-center">
                    <p class="text-purple-300/40 text-xs mb-1">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø§Øª</p>
                    <p class="text-2xl font-black text-purple-400" id="ov-attempts">-</p>
                </div>
                <div class="stat-card glass p-4 text-center">
                    <p class="text-purple-300/40 text-xs mb-1">Ø§Ù„Ø¨Ù„Ø§ØºØ§Øª</p>
                    <p class="text-2xl font-black text-red-400" id="ov-reports">-</p>
                </div>
            </div>
            <div class="grid lg:grid-cols-2 gap-4">
                <div class="glass p-5">
                    <h3 class="font-bold text-sm mb-3">ğŸ“ Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ø­Ø³Ø¨ Ø§Ù„Ù‚Ø³Ù…</h3>
                    <div class="space-y-2" id="ov-sections"></div>
                </div>
                <div class="glass p-5">
                    <h3 class="font-bold text-sm mb-3">ğŸ”¥ Ø£ÙƒØ«Ø± Ø³Ø¤Ø§Ù„ ÙŠØºÙ„Ø·ÙˆÙ† ÙÙŠÙ‡</h3>
                    <div id="ov-hardest" class="text-purple-300/40 text-sm">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</div>
                </div>
            </div>
        </div>

        <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â• Ø§Ù„Ø£Ø³Ø¦Ù„Ø© â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
        <div id="tab-questions" class="tab-section">
            <div class="flex items-center justify-between mb-5">
                <h2 class="text-xl font-black">ğŸ“ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø£Ø³Ø¦Ù„Ø©</h2>
                <button class="btn-p" onclick="openQuestionModal()">+ Ø¥Ø¶Ø§ÙØ© Ø³Ø¤Ø§Ù„</button>
            </div>
            <div class="flex gap-2 mb-4">
                <select id="q-filter" class="input-dark" style="max-width:160px" onchange="loadQuestions()">
                    <option value="all">ÙƒÙ„ Ø§Ù„Ø£Ù‚Ø³Ø§Ù…</option>
                    <option value="quant">ÙƒÙ…ÙŠ</option>
                    <option value="verbal">Ù„ÙØ¸ÙŠ</option>
                    <option value="tahsili">ØªØ­ØµÙŠÙ„ÙŠ</option>
                </select>
                <input type="text" id="q-search" class="input-dark" placeholder="Ø¨Ø­Ø« ÙÙŠ Ø§Ù„Ø£Ø³Ø¦Ù„Ø©..." oninput="loadQuestions()">
            </div>
            <div id="questions-list" class="space-y-2"></div>
        </div>

        <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â• Ø§Ù„Ø£Ø¹Ø¶Ø§Ø¡ â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
        <div id="tab-users" class="tab-section">
            <h2 class="text-xl font-black mb-5">ğŸ‘¥ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø£Ø¹Ø¶Ø§Ø¡</h2>
            <input type="text" id="u-search" class="input-dark mb-4" placeholder="Ø¨Ø­Ø« Ø¨Ø§Ù„Ø§Ø³Ù… Ø£Ùˆ Ø§Ù„Ø¥ÙŠÙ…ÙŠÙ„..." oninput="loadUsers()">
            <div class="glass overflow-x-auto">
                <table class="w-full text-sm">
                    <thead><tr class="border-b border-purple-500/10">
                        <th class="text-right p-3 text-purple-300/40 text-xs">Ø§Ù„Ø¹Ø¶Ùˆ</th>
                        <th class="text-right p-3 text-purple-300/40 text-xs">Ø§Ù„Ø¥ÙŠÙ…ÙŠÙ„</th>
                        <th class="text-center p-3 text-purple-300/40 text-xs">Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ</th>
                        <th class="text-center p-3 text-purple-300/40 text-xs">Ø§Ù„ØªØ³Ø¬ÙŠÙ„</th>
                        <th class="text-center p-3 text-purple-300/40 text-xs">Ø¥Ø¬Ø±Ø§Ø¡</th>
                    </tr></thead>
                    <tbody id="users-list"></tbody>
                </table>
            </div>
        </div>

        <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â• Ø§Ù„ÙƒÙˆØ¨ÙˆÙ†Ø§Øª â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
        <div id="tab-coupons" class="tab-section">
            <div class="flex items-center justify-between mb-5">
                <h2 class="text-xl font-black">ğŸŸï¸ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ÙƒÙˆØ¨ÙˆÙ†Ø§Øª</h2>
                <button class="btn-p" onclick="openCouponModal()">+ ÙƒÙˆØ¨ÙˆÙ† Ø¬Ø¯ÙŠØ¯</button>
            </div>
            <div class="glass overflow-x-auto">
                <table class="w-full text-sm">
                    <thead><tr class="border-b border-purple-500/10">
                        <th class="text-right p-3 text-purple-300/40 text-xs">Ø§Ù„ÙƒÙˆØ¯</th>
                        <th class="text-center p-3 text-purple-300/40 text-xs">Ø§Ù„Ø®ØµÙ…</th>
                        <th class="text-center p-3 text-purple-300/40 text-xs">Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…Ø§Øª</th>
                        <th class="text-center p-3 text-purple-300/40 text-xs">Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰</th>
                        <th class="text-center p-3 text-purple-300/40 text-xs">Ø§Ù„Ø­Ø§Ù„Ø©</th>
                        <th class="text-center p-3 text-purple-300/40 text-xs">Ø¥Ø¬Ø±Ø§Ø¡</th>
                    </tr></thead>
                    <tbody id="coupons-list"></tbody>
                </table>
            </div>
        </div>

        <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â• Ø§Ù„Ù…Ø§Ù„ÙŠØ© â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
        <div id="tab-finance" class="tab-section">
            <h2 class="text-xl font-black mb-5">ğŸ’° Ø§Ù„Ù…Ø§Ù„ÙŠØ© ÙˆØ§Ù„Ø§Ø´ØªØ±Ø§ÙƒØ§Øª</h2>
            <div class="grid grid-cols-2 lg:grid-cols-4 gap-3 mb-6">
                <div class="stat-card glass p-4 text-center">
                    <p class="text-purple-300/40 text-xs mb-1">Ù…Ø´ØªØ±ÙƒÙŠÙ† ÙØ¹Ø§Ù„ÙŠÙ†</p>
                    <p class="text-2xl font-black text-emerald-400" id="fin-active">-</p>
                </div>
                <div class="stat-card glass p-4 text-center">
                    <p class="text-purple-300/40 text-xs mb-1">Ø´Ù‡Ø±ÙŠ</p>
                    <p class="text-2xl font-black text-indigo-400" id="fin-monthly">-</p>
                </div>
                <div class="stat-card glass p-4 text-center">
                    <p class="text-purple-300/40 text-xs mb-1">Ø³Ù†ÙˆÙŠ</p>
                    <p class="text-2xl font-black text-purple-400" id="fin-yearly">-</p>
                </div>
                <div class="stat-card glass p-4 text-center">
                    <p class="text-purple-300/40 text-xs mb-1">Ù…Ø¬Ø§Ù†ÙŠ</p>
                    <p class="text-2xl font-black text-yellow-400" id="fin-free">-</p>
                </div>
            </div>
        </div>

        <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â• Ø§Ù„Ø¨Ù„Ø§ØºØ§Øª â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
        <div id="tab-reports" class="tab-section">
            <h2 class="text-xl font-black mb-5">ğŸš© Ø¨Ù„Ø§ØºØ§Øª Ø§Ù„Ø£Ø³Ø¦Ù„Ø©</h2>
            <div id="reports-list" class="space-y-2"></div>
        </div>

        <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â• Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ† â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
        <div id="tab-staff" class="tab-section">
            <div class="flex items-center justify-between mb-5">
                <h2 class="text-xl font-black">ğŸ”‘ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ† ÙˆØ§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª</h2>
                <button class="btn-p" onclick="openStaffModal()">+ Ø¥Ø¶Ø§ÙØ© Ù…ÙˆØ¸Ù</button>
            </div>
            <div class="glass overflow-x-auto">
                <table class="w-full text-sm">
                    <thead><tr class="border-b border-purple-500/10">
                        <th class="text-right p-3 text-purple-300/40 text-xs">Ø§Ù„Ø§Ø³Ù…</th>
                        <th class="text-right p-3 text-purple-300/40 text-xs">Ø§Ù„Ø¥ÙŠÙ…ÙŠÙ„</th>
                        <th class="text-center p-3 text-purple-300/40 text-xs">Ø§Ù„Ø¯ÙˆØ±</th>
                        <th class="text-center p-3 text-purple-300/40 text-xs">Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª</th>
                        <th class="text-center p-3 text-purple-300/40 text-xs">Ø¥Ø¬Ø±Ø§Ø¡</th>
                    </tr></thead>
                    <tbody id="staff-list"></tbody>
                </table>
            </div>
        </div>

        <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â• Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
        <div id="tab-settings" class="tab-section">
            <h2 class="text-xl font-black mb-5">âš™ï¸ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù…ÙˆÙ‚Ø¹</h2>

            <!-- Banner Text -->
            <div class="glass p-5 mb-4">
                <h3 class="font-bold text-sm mb-3">ğŸ“¢ Ù†Øµ Ø§Ù„Ø¨Ø§Ù†Ø± Ø§Ù„Ø¹Ù„ÙˆÙŠ</h3>
                <p class="text-purple-300/30 text-xs mb-2">Ù‡Ø°Ø§ Ø§Ù„Ù†Øµ ÙŠØ¸Ù‡Ø± ÙÙŠ Ø§Ù„Ø´Ø±ÙŠØ· Ø§Ù„Ù…ØªØ­Ø±Ùƒ Ø£Ø¹Ù„Ù‰ ÙƒÙ„ Ø§Ù„ØµÙØ­Ø§Øª</p>
                <textarea id="set-banner" class="input-dark" rows="2" placeholder="Ù†Øµ Ø§Ù„Ø¨Ø§Ù†Ø±..."></textarea>
                <button class="btn-p mt-2" onclick="saveSetting('banner_text', document.getElementById('set-banner').value)">Ø­ÙØ¸</button>
            </div>

            <!-- Colors -->
            <div class="glass p-5 mb-4">
                <h3 class="font-bold text-sm mb-3">ğŸ¨ Ø«ÙŠÙ… Ø§Ù„Ø£Ù„ÙˆØ§Ù†</h3>
                <p class="text-purple-300/30 text-xs mb-3">Ø§Ø®ØªØ± Ù†Ù…Ø· Ø§Ù„Ø£Ù„ÙˆØ§Ù† Ù„Ù„Ù…Ù†ØµØ©</p>
                <div class="flex gap-3 flex-wrap">
                    <label class="cursor-pointer">
                        <input type="radio" name="theme" value="purple" class="hidden peer" checked>
                        <div class="peer-checked:ring-2 peer-checked:ring-purple-400 w-12 h-12 rounded-xl" style="background:linear-gradient(135deg,#6366f1,#8b5cf6)"></div>
                        <p class="text-[10px] text-center text-purple-300/40 mt-1">Ø¨Ù†ÙØ³Ø¬ÙŠ</p>
                    </label>
                    <label class="cursor-pointer">
                        <input type="radio" name="theme" value="blue" class="hidden peer">
                        <div class="peer-checked:ring-2 peer-checked:ring-blue-400 w-12 h-12 rounded-xl" style="background:linear-gradient(135deg,#3b82f6,#1d4ed8)"></div>
                        <p class="text-[10px] text-center text-purple-300/40 mt-1">Ø£Ø²Ø±Ù‚</p>
                    </label>
                    <label class="cursor-pointer">
                        <input type="radio" name="theme" value="green" class="hidden peer">
                        <div class="peer-checked:ring-2 peer-checked:ring-emerald-400 w-12 h-12 rounded-xl" style="background:linear-gradient(135deg,#10b981,#059669)"></div>
                        <p class="text-[10px] text-center text-purple-300/40 mt-1">Ø£Ø®Ø¶Ø±</p>
                    </label>
                    <label class="cursor-pointer">
                        <input type="radio" name="theme" value="rose" class="hidden peer">
                        <div class="peer-checked:ring-2 peer-checked:ring-pink-400 w-12 h-12 rounded-xl" style="background:linear-gradient(135deg,#ec4899,#be185d)"></div>
                        <p class="text-[10px] text-center text-purple-300/40 mt-1">ÙˆØ±Ø¯ÙŠ</p>
                    </label>
                </div>
                <button class="btn-p mt-3" onclick="saveTheme()">Ø­ÙØ¸ Ø§Ù„Ø«ÙŠÙ…</button>
            </div>

            <!-- Pricing -->
            <div class="glass p-5 mb-4">
                <h3 class="font-bold text-sm mb-3">ğŸ’° Ø£Ø³Ø¹Ø§Ø± Ø§Ù„Ø§Ø´ØªØ±Ø§ÙƒØ§Øª</h3>
                <div class="grid grid-cols-2 gap-3">
                    <div>
                        <label class="text-purple-300/40 text-xs mb-1 block">Ø§Ù„Ø´Ù‡Ø±ÙŠ (Ø±ÙŠØ§Ù„)</label>
                        <input type="number" id="set-price-monthly" class="input-dark" value="29">
                    </div>
                    <div>
                        <label class="text-purple-300/40 text-xs mb-1 block">Ø§Ù„Ø³Ù†ÙˆÙŠ (Ø±ÙŠØ§Ù„)</label>
                        <input type="number" id="set-price-yearly" class="input-dark" value="228">
                    </div>
                </div>
                <button class="btn-p mt-2" onclick="savePricing()">Ø­ÙØ¸ Ø§Ù„Ø£Ø³Ø¹Ø§Ø±</button>
            </div>

            <!-- Free Limit -->
            <div class="glass p-5">
                <h3 class="font-bold text-sm mb-3">ğŸ†“ Ø­Ø¯ Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ø§Ù„Ù…Ø¬Ø§Ù†ÙŠØ©</h3>
                <div>
                    <label class="text-purple-300/40 text-xs mb-1 block">Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ø§Ù„Ù…Ø¬Ø§Ù†ÙŠØ©</label>
                    <input type="number" id="set-free-limit" class="input-dark" value="10" style="max-width:120px">
                </div>
                <button class="btn-p mt-2" onclick="saveSetting('free_limit', document.getElementById('set-free-limit').value)">Ø­ÙØ¸</button>
            </div>
        </div>
    </div>

    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â• Modals â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->

    <!-- Question Modal -->
    <div id="questionModal" class="modal-bg hidden">
        <div class="modal-box">
            <div class="flex items-center justify-between mb-4">
                <h3 class="font-bold text-base" id="qModalTitle">Ø¥Ø¶Ø§ÙØ© Ø³Ø¤Ø§Ù„</h3>
                <button onclick="closeModal('questionModal')" class="text-purple-300/30 hover:text-white text-lg">âœ•</button>
            </div>
            <input type="hidden" id="qm-id">
            <div class="space-y-3">
                <div>
                    <label class="text-purple-300/40 text-xs mb-1 block">Ø§Ù„Ù‚Ø³Ù…</label>
                    <select id="qm-section" class="input-dark">
                        <option value="quant">Ù‚Ø¯Ø±Ø§Øª ÙƒÙ…ÙŠ</option>
                        <option value="verbal">Ù‚Ø¯Ø±Ø§Øª Ù„ÙØ¸ÙŠ</option>
                        <option value="tahsili">Ø§Ù„ØªØ­ØµÙŠÙ„ÙŠ</option>
                    </select>
                </div>
                <div>
                    <label class="text-purple-300/40 text-xs mb-1 block">Ù†Øµ Ø§Ù„Ø³Ø¤Ø§Ù„</label>
                    <textarea id="qm-text" class="input-dark" rows="3" placeholder="Ø§ÙƒØªØ¨ Ø§Ù„Ø³Ø¤Ø§Ù„ Ù‡Ù†Ø§..."></textarea>
                </div>
                <div class="grid grid-cols-2 gap-2">
                    <div><label class="text-purple-300/40 text-xs mb-1 block">Ø§Ù„Ø®ÙŠØ§Ø± 1</label><input id="qm-c0" class="input-dark" placeholder="Ø§Ù„Ø®ÙŠØ§Ø± Ø§Ù„Ø£ÙˆÙ„"></div>
                    <div><label class="text-purple-300/40 text-xs mb-1 block">Ø§Ù„Ø®ÙŠØ§Ø± 2</label><input id="qm-c1" class="input-dark" placeholder="Ø§Ù„Ø®ÙŠØ§Ø± Ø§Ù„Ø«Ø§Ù†ÙŠ"></div>
                    <div><label class="text-purple-300/40 text-xs mb-1 block">Ø§Ù„Ø®ÙŠØ§Ø± 3</label><input id="qm-c2" class="input-dark" placeholder="Ø§Ù„Ø®ÙŠØ§Ø± Ø§Ù„Ø«Ø§Ù„Ø«"></div>
                    <div><label class="text-purple-300/40 text-xs mb-1 block">Ø§Ù„Ø®ÙŠØ§Ø± 4</label><input id="qm-c3" class="input-dark" placeholder="Ø§Ù„Ø®ÙŠØ§Ø± Ø§Ù„Ø±Ø§Ø¨Ø¹"></div>
                </div>
                <div>
                    <label class="text-purple-300/40 text-xs mb-1 block">Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø§Ù„ØµØ­ÙŠØ­Ø©</label>
                    <select id="qm-correct" class="input-dark">
                        <option value="0">Ø§Ù„Ø®ÙŠØ§Ø± 1</option>
                        <option value="1">Ø§Ù„Ø®ÙŠØ§Ø± 2</option>
                        <option value="2">Ø§Ù„Ø®ÙŠØ§Ø± 3</option>
                        <option value="3">Ø§Ù„Ø®ÙŠØ§Ø± 4</option>
                    </select>
                </div>
                <div>
                    <label class="text-purple-300/40 text-xs mb-1 block">Ø§Ù„Ø´Ø±Ø­</label>
                    <textarea id="qm-explanation" class="input-dark" rows="3" placeholder="Ø´Ø±Ø­ Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø§Ù„ØµØ­ÙŠØ­Ø©..."></textarea>
                </div>
                <div>
                    <label class="text-purple-300/40 text-xs mb-1 block">Ø±Ø§Ø¨Ø· Ø§Ù„ØµÙˆØ±Ø© (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label>
                    <input id="qm-image" class="input-dark" placeholder="https://...">
                </div>
                <button class="btn-p w-full" onclick="saveQuestion()">ğŸ’¾ Ø­ÙØ¸ Ø§Ù„Ø³Ø¤Ø§Ù„</button>
            </div>
        </div>
    </div>

    <!-- User Edit Modal -->
    <div id="userModal" class="modal-bg hidden">
        <div class="modal-box">
            <div class="flex items-center justify-between mb-4">
                <h3 class="font-bold text-base">ØªØ¹Ø¯ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¹Ø¶Ùˆ</h3>
                <button onclick="closeModal('userModal')" class="text-purple-300/30 hover:text-white text-lg">âœ•</button>
            </div>
            <input type="hidden" id="um-id">
            <div class="space-y-3">
                <div><label class="text-purple-300/40 text-xs mb-1 block">Ø§Ù„Ø§Ø³Ù…</label><input id="um-name" class="input-dark"></div>
                <div><label class="text-purple-300/40 text-xs mb-1 block">Ø§Ù„Ø¥ÙŠÙ…ÙŠÙ„</label><input id="um-email" class="input-dark" disabled></div>
                <div><label class="text-purple-300/40 text-xs mb-1 block">Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ</label>
                    <select id="um-sub" class="input-dark">
                        <option value="free">Ù…Ø¬Ø§Ù†ÙŠ</option>
                        <option value="monthly">Ø´Ù‡Ø±ÙŠ</option>
                        <option value="yearly">Ø³Ù†ÙˆÙŠ</option>
                    </select>
                </div>
                <div><label class="text-purple-300/40 text-xs mb-1 block">Ø§Ù„Ø¯ÙˆØ±</label>
                    <select id="um-role" class="input-dark">
                        <option value="user">Ù…Ø³ØªØ®Ø¯Ù…</option>
                        <option value="admin">Ø£Ø¯Ù…Ù†</option>
                    </select>
                </div>
                <button class="btn-p w-full" onclick="saveUser()">ğŸ’¾ Ø­ÙØ¸ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª</button>
            </div>
        </div>
    </div>

    <!-- Coupon Modal -->
    <div id="couponModal" class="modal-bg hidden">
        <div class="modal-box">
            <div class="flex items-center justify-between mb-4">
                <h3 class="font-bold text-base">Ø¥Ø¶Ø§ÙØ© ÙƒÙˆØ¨ÙˆÙ†</h3>
                <button onclick="closeModal('couponModal')" class="text-purple-300/30 hover:text-white text-lg">âœ•</button>
            </div>
            <div class="space-y-3">
                <div><label class="text-purple-300/40 text-xs mb-1 block">ÙƒÙˆØ¯ Ø§Ù„ÙƒÙˆØ¨ÙˆÙ†</label><input id="cm-code" class="input-dark" placeholder="MASARI50" style="text-transform:uppercase"></div>
                <div>
                    <label class="text-purple-300/40 text-xs mb-1 block">Ù†ÙˆØ¹ Ø§Ù„Ø®ØµÙ…</label>
                    <select id="cm-type" class="input-dark">
                        <option value="percentage">Ù†Ø³Ø¨Ø© Ù…Ø¦ÙˆÙŠØ© (%)</option>
                        <option value="fixed">Ù…Ø¨Ù„Øº Ø«Ø§Ø¨Øª (Ø±ÙŠØ§Ù„)</option>
                    </select>
                </div>
                <div><label class="text-purple-300/40 text-xs mb-1 block">Ù‚ÙŠÙ…Ø© Ø§Ù„Ø®ØµÙ…</label><input type="number" id="cm-value" class="input-dark" placeholder="50"></div>
                <div><label class="text-purple-300/40 text-xs mb-1 block">Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰ Ù„Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…</label><input type="number" id="cm-max" class="input-dark" placeholder="100" value="100"></div>
                <div><label class="text-purple-300/40 text-xs mb-1 block">ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ù†ØªÙ‡Ø§Ø¡</label><input type="date" id="cm-expires" class="input-dark"></div>
                <button class="btn-p w-full" onclick="saveCoupon()">ğŸ’¾ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„ÙƒÙˆØ¨ÙˆÙ†</button>
            </div>
        </div>
    </div>

    <!-- Staff Modal -->
    <div id="staffModal" class="modal-bg hidden">
        <div class="modal-box">
            <div class="flex items-center justify-between mb-4">
                <h3 class="font-bold text-base">Ø¥Ø¶Ø§ÙØ© Ù…ÙˆØ¸Ù</h3>
                <button onclick="closeModal('staffModal')" class="text-purple-300/30 hover:text-white text-lg">âœ•</button>
            </div>
            <div class="space-y-3">
                <div><label class="text-purple-300/40 text-xs mb-1 block">Ø¥ÙŠÙ…ÙŠÙ„ Ø§Ù„Ù…ÙˆØ¸Ù (Ø­Ø³Ø§Ø¨ Ù…ÙˆØ¬ÙˆØ¯)</label><input id="sm-email" class="input-dark" placeholder="staff@masari.sa"></div>
                <div><label class="text-purple-300/40 text-xs mb-1 block">Ø§Ù„Ù…Ø³Ù…Ù‰ Ø§Ù„ÙˆØ¸ÙŠÙÙŠ</label><input id="sm-title" class="input-dark" placeholder="Ù…Ø¯ÙŠØ± Ø§Ù„Ù…Ø­ØªÙˆÙ‰"></div>
                <div>
                    <label class="text-purple-300/40 text-xs mb-1 block">Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª</label>
                    <div class="space-y-2 mt-1">
                        <label class="flex items-center gap-2 text-sm"><input type="checkbox" id="sp-questions" checked><span class="text-purple-200/70">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø£Ø³Ø¦Ù„Ø©</span></label>
                        <label class="flex items-center gap-2 text-sm"><input type="checkbox" id="sp-users"><span class="text-purple-200/70">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø£Ø¹Ø¶Ø§Ø¡</span></label>
                        <label class="flex items-center gap-2 text-sm"><input type="checkbox" id="sp-coupons"><span class="text-purple-200/70">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ÙƒÙˆØ¨ÙˆÙ†Ø§Øª</span></label>
                        <label class="flex items-center gap-2 text-sm"><input type="checkbox" id="sp-finance"><span class="text-purple-200/70">Ø§Ù„Ù…Ø§Ù„ÙŠØ©</span></label>
                        <label class="flex items-center gap-2 text-sm"><input type="checkbox" id="sp-settings"><span class="text-purple-200/70">Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</span></label>
                    </div>
                </div>
                <button class="btn-p w-full" onclick="saveStaff()">ğŸ’¾ Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…ÙˆØ¸Ù</button>
            </div>
        </div>
    </div>

    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â• Scripts â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script>
        const sb = window.supabase.createClient(
            'https://czzcmbxejxbotjemyuqf.supabase.co',
            'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImN6emNtYnhlanhib3RqZW15dXFmIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzAxNzQ0ODEsImV4cCI6MjA4NTc1MDQ4MX0.xDfG1qsDZGyUrpL44JfqOtk57dVsLaMsvIzJz1KgiR0'
        );
        let currentAdmin = null;

        // â•â•â• Auth â•â•â•
        async function checkAdmin() {
            var { data: { session } } = await sb.auth.getSession();
            if (!session) { window.location.href = 'admin-login.html'; return; }
            var { data: profile } = await sb.from('profiles').select('role, full_name').eq('id', session.user.id).single();
            if (!profile || profile.role !== 'admin') {
                window.location.href = 'admin-login.html';
                return;
            }
            currentAdmin = { id: session.user.id, ...profile };
            loadOverview();
        }

        function logout() { sb.auth.signOut().then(function(){ window.location.href = 'login.html'; }); }

        // â•â•â• Tab Switching â•â•â•
        function switchTab(tab) {
            document.querySelectorAll('.tab-section').forEach(function(s){ s.classList.remove('active'); });
            document.querySelectorAll('.sidebar-link').forEach(function(l){ l.classList.remove('active'); });
            document.getElementById('tab-' + tab).classList.add('active');
            event.currentTarget.classList.add('active');
            if (tab === 'overview') loadOverview();
            if (tab === 'questions') loadQuestions();
            if (tab === 'users') loadUsers();
            if (tab === 'coupons') loadCoupons();
            if (tab === 'finance') loadFinance();
            if (tab === 'reports') loadReports();
            if (tab === 'staff') loadStaff();
            if (tab === 'settings') loadSettings();
        }

        // â•â•â• Toast â•â•â•
        function toast(msg, ok) {
            var t = document.getElementById('toast');
            t.textContent = msg; t.className = 'toast ' + (ok ? 'toast-ok' : 'toast-err');
            setTimeout(function(){ t.classList.add('hidden'); }, 3000);
        }

        function closeModal(id) { document.getElementById(id).classList.add('hidden'); }

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        //  Ù†Ø¸Ø±Ø© Ø¹Ø§Ù…Ø©
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        async function loadOverview() {
            var { data: q } = await sb.from('questions').select('section');
            var { data: u } = await sb.from('profiles').select('id');
            var { data: a } = await sb.from('attempts').select('id');
            var { data: r } = await sb.from('reports').select('id');

            document.getElementById('ov-questions').textContent = q ? q.length : 0;
            document.getElementById('ov-users').textContent = u ? u.length : 0;
            document.getElementById('ov-attempts').textContent = a ? a.length : 0;
            document.getElementById('ov-reports').textContent = r ? r.length : 0;

            // Section breakdown
            if (q) {
                var counts = { quant: 0, verbal: 0, tahsili: 0 };
                q.forEach(function(x) { if (counts[x.section] !== undefined) counts[x.section]++; });
                var names = { quant: 'Ù‚Ø¯Ø±Ø§Øª ÙƒÙ…ÙŠ', verbal: 'Ù‚Ø¯Ø±Ø§Øª Ù„ÙØ¸ÙŠ', tahsili: 'Ø§Ù„ØªØ­ØµÙŠÙ„ÙŠ' };
                var colors = { quant: '#6366f1', verbal: '#10b981', tahsili: '#8b5cf6' };
                var total = q.length || 1;
                var html = '';
                for (var k in counts) {
                    var pct = Math.round((counts[k] / total) * 100);
                    html += '<div class="flex items-center justify-between text-xs mb-1"><span class="text-purple-200/60">' + names[k] + '</span><span class="font-bold">' + counts[k] + '</span></div>';
                    html += '<div class="h-1.5 rounded-full mb-2" style="background:rgba(255,255,255,0.06)"><div class="h-full rounded-full" style="width:' + pct + '%;background:' + colors[k] + '"></div></div>';
                }
                document.getElementById('ov-sections').innerHTML = html;
            }

            // Hardest question
            if (a && a.length > 0) {
                var { data: wrongA } = await sb.from('attempts').select('question_id').eq('is_correct', false);
                if (wrongA && wrongA.length > 0) {
                    var freq = {};
                    wrongA.forEach(function(x) { freq[x.question_id] = (freq[x.question_id] || 0) + 1; });
                    var hardestId = Object.keys(freq).sort(function(a,b) { return freq[b] - freq[a]; })[0];
                    var { data: hq } = await sb.from('questions').select('question_text, section').eq('id', hardestId).single();
                    if (hq) {
                        var sn = { quant: 'ÙƒÙ…ÙŠ', verbal: 'Ù„ÙØ¸ÙŠ', tahsili: 'ØªØ­ØµÙŠÙ„ÙŠ' };
                        document.getElementById('ov-hardest').innerHTML = '<span class="badge badge-' + (hq.section === 'quant' ? 'monthly' : hq.section === 'verbal' ? 'yearly' : 'free') + ' mb-2">' + (sn[hq.section] || '') + '</span><p class="text-white text-sm">' + hq.question_text + '</p><p class="text-red-400/60 text-xs mt-1">' + freq[hardestId] + ' Ø®Ø·Ø£</p>';
                    }
                } else {
                    document.getElementById('ov-hardest').innerHTML = '<p class="text-purple-300/30 text-sm">Ù…Ø§ ÙÙŠÙ‡ Ø£Ø®Ø·Ø§Ø¡ Ø¨Ø¹Ø¯</p>';
                }
            }
        }

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        //  Ø§Ù„Ø£Ø³Ø¦Ù„Ø©
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        async function loadQuestions() {
            var filter = document.getElementById('q-filter').value;
            var search = document.getElementById('q-search').value.trim().toLowerCase();
            var query = sb.from('questions').select('*').order('created_at', { ascending: false });
            if (filter !== 'all') query = query.eq('section', filter);
            var { data } = await query;
            if (!data) data = [];
            if (search) data = data.filter(function(q) { return q.question_text.toLowerCase().includes(search); });

            var sn = { quant: 'ÙƒÙ…ÙŠ', verbal: 'Ù„ÙØ¸ÙŠ', tahsili: 'ØªØ­ØµÙŠÙ„ÙŠ' };
            var html = '';
            data.forEach(function(q) {
                html += '<div class="glass p-4 table-row"><div class="flex items-start justify-between gap-3"><div class="flex-1"><span class="badge badge-' + (q.section === 'quant' ? 'monthly' : q.section === 'verbal' ? 'yearly' : 'free') + ' mb-1">' + (sn[q.section] || '') + '</span><p class="text-sm text-white leading-relaxed">' + q.question_text.substring(0, 100) + (q.question_text.length > 100 ? '...' : '') + '</p></div><div class="flex gap-1 flex-shrink-0"><button class="btn-s" onclick="editQuestion(\'' + q.id + '\')">âœï¸</button><button class="btn-d" onclick="deleteQuestion(\'' + q.id + '\')">ğŸ—‘ï¸</button></div></div></div>';
            });
            document.getElementById('questions-list').innerHTML = html || '<p class="text-purple-300/30 text-sm text-center py-8">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø£Ø³Ø¦Ù„Ø©</p>';
        }

        function openQuestionModal(q) {
            document.getElementById('qModalTitle').textContent = q ? 'ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø³Ø¤Ø§Ù„' : 'Ø¥Ø¶Ø§ÙØ© Ø³Ø¤Ø§Ù„';
            document.getElementById('qm-id').value = q ? q.id : '';
            document.getElementById('qm-section').value = q ? q.section : 'quant';
            document.getElementById('qm-text').value = q ? q.question_text : '';
            var c = q ? (q.choices || []) : [];
            for (var i = 0; i < 4; i++) document.getElementById('qm-c' + i).value = c[i] || '';
            document.getElementById('qm-correct').value = q ? q.correct_index : '0';
            document.getElementById('qm-explanation').value = q ? (q.explanation || '') : '';
            document.getElementById('qm-image').value = q ? (q.image_url || '') : '';
            document.getElementById('questionModal').classList.remove('hidden');
        }

        async function editQuestion(id) {
            var { data } = await sb.from('questions').select('*').eq('id', id).single();
            if (data) openQuestionModal(data);
        }

        async function saveQuestion() {
            var id = document.getElementById('qm-id').value;
            var obj = {
                section: document.getElementById('qm-section').value,
                question_text: document.getElementById('qm-text').value,
                choices: [document.getElementById('qm-c0').value, document.getElementById('qm-c1').value, document.getElementById('qm-c2').value, document.getElementById('qm-c3').value],
                correct_index: parseInt(document.getElementById('qm-correct').value),
                explanation: document.getElementById('qm-explanation').value,
                image_url: document.getElementById('qm-image').value || null
            };
            if (!obj.question_text || !obj.choices[0]) { toast('Ø§Ù…Ù„Ø£ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©', false); return; }

            if (id) {
                var { error } = await sb.from('questions').update(obj).eq('id', id);
                if (error) { toast('Ø®Ø·Ø£: ' + error.message, false); return; }
                toast('ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø³Ø¤Ø§Ù„', true);
            } else {
                var { error } = await sb.from('questions').insert(obj);
                if (error) { toast('Ø®Ø·Ø£: ' + error.message, false); return; }
                toast('ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø³Ø¤Ø§Ù„', true);
            }
            closeModal('questionModal');
            loadQuestions();
        }

        async function deleteQuestion(id) {
            if (!confirm('Ù…ØªØ£ÙƒØ¯ ØªØ¨ÙŠ ØªØ­Ø°Ù Ù‡Ø§Ù„Ø³Ø¤Ø§Ù„ØŸ')) return;
            await sb.from('attempts').delete().eq('question_id', id);
            await sb.from('reports').delete().eq('question_id', id);
            var { error } = await sb.from('questions').delete().eq('id', id);
            if (error) toast('Ø®Ø·Ø£ Ø¨Ø§Ù„Ø­Ø°Ù', false);
            else { toast('ØªÙ… Ø§Ù„Ø­Ø°Ù', true); loadQuestions(); }
        }

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        //  Ø§Ù„Ø£Ø¹Ø¶Ø§Ø¡
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        async function loadUsers() {
            var search = (document.getElementById('u-search').value || '').trim().toLowerCase();
            var { data } = await sb.from('profiles').select('*').order('created_at', { ascending: false });
            if (!data) data = [];
            if (search) data = data.filter(function(u) { return (u.full_name || '').toLowerCase().includes(search) || (u.email || '').toLowerCase().includes(search); });
            var html = '';
            data.forEach(function(u) {
                var badge = u.subscription_type === 'monthly' ? 'badge-monthly' : u.subscription_type === 'yearly' ? 'badge-yearly' : 'badge-free';
                var label = u.subscription_type === 'monthly' ? 'Ø´Ù‡Ø±ÙŠ' : u.subscription_type === 'yearly' ? 'Ø³Ù†ÙˆÙŠ' : 'Ù…Ø¬Ø§Ù†ÙŠ';
                html += '<tr class="table-row"><td class="p-3"><div class="flex items-center gap-2"><span class="text-lg">' + (u.avatar_emoji || 'ğŸ‘¤') + '</span><span class="text-sm font-medium">' + (u.full_name || 'â€”') + '</span>' + (u.role === 'admin' ? '<span class="badge badge-admin">Ø£Ø¯Ù…Ù†</span>' : '') + '</div></td><td class="p-3 text-purple-300/40 text-xs">' + (u.email || '') + '</td><td class="p-3 text-center"><span class="badge ' + badge + '">' + label + '</span></td><td class="p-3 text-center text-purple-300/30 text-xs">' + (u.created_at ? new Date(u.created_at).toLocaleDateString('ar-SA') : '') + '</td><td class="p-3 text-center"><button class="btn-s" onclick="editUser(\'' + u.id + '\')">âœï¸</button></td></tr>';
            });
            document.getElementById('users-list').innerHTML = html;
        }

        async function editUser(id) {
            var { data } = await sb.from('profiles').select('*').eq('id', id).single();
            if (!data) return;
            document.getElementById('um-id').value = data.id;
            document.getElementById('um-name').value = data.full_name || '';
            document.getElementById('um-email').value = data.email || '';
            document.getElementById('um-sub').value = data.subscription_type || 'free';
            document.getElementById('um-role').value = data.role || 'user';
            document.getElementById('userModal').classList.remove('hidden');
        }

        async function saveUser() {
            var id = document.getElementById('um-id').value;
            var { error } = await sb.from('profiles').update({
                full_name: document.getElementById('um-name').value,
                subscription_type: document.getElementById('um-sub').value,
                role: document.getElementById('um-role').value
            }).eq('id', id);
            if (error) toast('Ø®Ø·Ø£', false);
            else { toast('ØªÙ… Ø§Ù„ØªØ­Ø¯ÙŠØ«', true); closeModal('userModal'); loadUsers(); }
        }

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        //  Ø§Ù„ÙƒÙˆØ¨ÙˆÙ†Ø§Øª
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        async function loadCoupons() {
            var { data } = await sb.from('coupons').select('*').order('created_at', { ascending: false });
            if (!data || data.length === 0) { document.getElementById('coupons-list').innerHTML = '<tr><td colspan="6" class="p-6 text-center text-purple-300/30 text-sm">Ù„Ø§ ØªÙˆØ¬Ø¯ ÙƒÙˆØ¨ÙˆÙ†Ø§Øª</td></tr>'; return; }
            var html = '';
            data.forEach(function(c) {
                var active = !c.expires_at || new Date(c.expires_at) > new Date();
                html += '<tr class="table-row"><td class="p-3 font-bold text-sm text-indigo-300">' + c.code + '</td><td class="p-3 text-center text-sm">' + c.discount_value + (c.discount_type === 'percentage' ? '%' : ' Ø±ÙŠØ§Ù„') + '</td><td class="p-3 text-center text-sm font-bold">' + (c.used_count || 0) + '</td><td class="p-3 text-center text-sm text-purple-300/40">' + (c.max_uses || 'âˆ') + '</td><td class="p-3 text-center"><span class="badge ' + (active ? 'badge-yearly' : 'badge-free') + '">' + (active ? 'ÙØ¹Ù‘Ø§Ù„' : 'Ù…Ù†ØªÙ‡ÙŠ') + '</span></td><td class="p-3 text-center"><button class="btn-d" onclick="deleteCoupon(\'' + c.id + '\')">ğŸ—‘ï¸</button></td></tr>';
            });
            document.getElementById('coupons-list').innerHTML = html;
        }

        function openCouponModal() { document.getElementById('couponModal').classList.remove('hidden'); }

        async function saveCoupon() {
            var obj = {
                code: document.getElementById('cm-code').value.toUpperCase().trim(),
                discount_type: document.getElementById('cm-type').value,
                discount_value: parseFloat(document.getElementById('cm-value').value),
                max_uses: parseInt(document.getElementById('cm-max').value) || 100,
                used_count: 0,
                expires_at: document.getElementById('cm-expires').value || null
            };
            if (!obj.code || !obj.discount_value) { toast('Ø§Ù…Ù„Ø£ Ø§Ù„Ø­Ù‚ÙˆÙ„', false); return; }
            var { error } = await sb.from('coupons').insert(obj);
            if (error) toast('Ø®Ø·Ø£: ' + error.message, false);
            else { toast('ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„ÙƒÙˆØ¨ÙˆÙ†', true); closeModal('couponModal'); loadCoupons(); }
        }

        async function deleteCoupon(id) {
            if (!confirm('Ù…ØªØ£ÙƒØ¯ ØªØ­Ø°Ù Ø§Ù„ÙƒÙˆØ¨ÙˆÙ†ØŸ')) return;
            await sb.from('coupons').delete().eq('id', id);
            toast('ØªÙ… Ø§Ù„Ø­Ø°Ù', true); loadCoupons();
        }

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        //  Ø§Ù„Ù…Ø§Ù„ÙŠØ©
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        async function loadFinance() {
            var { data } = await sb.from('profiles').select('subscription_type');
            if (!data) return;
            var m = data.filter(function(u){ return u.subscription_type === 'monthly'; }).length;
            var y = data.filter(function(u){ return u.subscription_type === 'yearly'; }).length;
            var f = data.filter(function(u){ return !u.subscription_type || u.subscription_type === 'free'; }).length;
            document.getElementById('fin-active').textContent = m + y;
            document.getElementById('fin-monthly').textContent = m;
            document.getElementById('fin-yearly').textContent = y;
            document.getElementById('fin-free').textContent = f;
        }

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        //  Ø§Ù„Ø¨Ù„Ø§ØºØ§Øª
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        async function loadReports() {
            var { data } = await sb.from('reports').select('*, questions(question_text, section)').order('reported_at', { ascending: false });
            if (!data || data.length === 0) { document.getElementById('reports-list').innerHTML = '<div class="glass p-8 text-center text-purple-300/30 text-sm">Ù…Ø§ ÙÙŠÙ‡ Ø¨Ù„Ø§ØºØ§Øª</div>'; return; }
            var html = '';
            data.forEach(function(r) {
                html += '<div class="glass p-4"><div class="flex items-start justify-between gap-3"><div><p class="text-sm text-white mb-1">' + (r.questions ? r.questions.question_text.substring(0,80) + '...' : 'Ø³Ø¤Ø§Ù„ Ù…Ø­Ø°ÙˆÙ') + '</p><p class="text-purple-300/40 text-xs">Ø§Ù„Ø³Ø¨Ø¨: ' + (r.reason || 'Ù…Ø§ Ø­Ø¯Ø¯') + '</p><p class="text-purple-300/20 text-xs mt-1">' + new Date(r.reported_at).toLocaleDateString('ar-SA') + '</p></div><button class="btn-d flex-shrink-0" onclick="deleteReport(\'' + r.id + '\')">âœ•</button></div></div>';
            });
            document.getElementById('reports-list').innerHTML = html;
        }

        async function deleteReport(id) { await sb.from('reports').delete().eq('id', id); toast('ØªÙ… Ø­Ø°Ù Ø§Ù„Ø¨Ù„Ø§Øº', true); loadReports(); }

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        //  Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        async function loadStaff() {
            var { data } = await sb.from('profiles').select('*').eq('role', 'admin');
            if (!data) data = [];
            var html = '';
            data.forEach(function(s) {
                html += '<tr class="table-row"><td class="p-3 text-sm font-medium">' + (s.full_name || 'â€”') + '</td><td class="p-3 text-purple-300/40 text-xs">' + (s.email || '') + '</td><td class="p-3 text-center"><span class="badge badge-admin">Ø£Ø¯Ù…Ù†</span></td><td class="p-3 text-center text-purple-300/30 text-xs">ÙƒØ§Ù…Ù„</td><td class="p-3 text-center">' + (s.id !== currentAdmin.id ? '<button class="btn-d" onclick="removeStaff(\'' + s.id + '\')">Ø¥Ø²Ø§Ù„Ø©</button>' : '<span class="text-purple-300/20 text-xs">Ø£Ù†Øª</span>') + '</td></tr>';
            });
            document.getElementById('staff-list').innerHTML = html;
        }

        function openStaffModal() { document.getElementById('staffModal').classList.remove('hidden'); }

        async function saveStaff() {
            var email = document.getElementById('sm-email').value.trim();
            if (!email) { toast('Ø£Ø¯Ø®Ù„ Ø§Ù„Ø¥ÙŠÙ…ÙŠÙ„', false); return; }
            var { data: user } = await sb.from('profiles').select('id').eq('email', email).single();
            if (!user) { toast('Ù…Ø§ Ù„Ù‚ÙŠÙ†Ø§ Ø­Ø³Ø§Ø¨ Ø¨Ù‡Ø§Ù„Ø¥ÙŠÙ…ÙŠÙ„', false); return; }
            var { error } = await sb.from('profiles').update({ role: 'admin' }).eq('id', user.id);
            if (error) toast('Ø®Ø·Ø£', false);
            else { toast('ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…ÙˆØ¸Ù ÙƒØ£Ø¯Ù…Ù†', true); closeModal('staffModal'); loadStaff(); }
        }

        async function removeStaff(id) {
            if (!confirm('Ù…ØªØ£ÙƒØ¯ ØªØ´ÙŠÙ„ ØµÙ„Ø§Ø­ÙŠØ§Øª Ø§Ù„Ø£Ø¯Ù…Ù†ØŸ')) return;
            await sb.from('profiles').update({ role: 'user' }).eq('id', id);
            toast('ØªÙ… Ø¥Ø²Ø§Ù„Ø© Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª', true); loadStaff();
        }

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        //  Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        async function loadSettings() {
            var { data } = await sb.from('site_settings').select('*');
            if (data) {
                data.forEach(function(s) {
                    if (s.key === 'banner_text') document.getElementById('set-banner').value = s.value || '';
                    if (s.key === 'free_limit') document.getElementById('set-free-limit').value = s.value || '10';
                    if (s.key === 'price_monthly') document.getElementById('set-price-monthly').value = s.value || '29';
                    if (s.key === 'price_yearly') document.getElementById('set-price-yearly').value = s.value || '228';
                    if (s.key === 'theme') {
                        var r = document.querySelector('input[name="theme"][value="' + s.value + '"]');
                        if (r) r.checked = true;
                    }
                });
            }
        }

        async function saveSetting(key, value) {
            var { data: existing } = await sb.from('site_settings').select('id').eq('key', key).single();
            if (existing) {
                await sb.from('site_settings').update({ value: value }).eq('key', key);
            } else {
                await sb.from('site_settings').insert({ key: key, value: value });
            }
            toast('ØªÙ… Ø§Ù„Ø­ÙØ¸', true);
        }

        function saveTheme() {
            var v = document.querySelector('input[name="theme"]:checked');
            if (v) saveSetting('theme', v.value);
        }

        function savePricing() {
            saveSetting('price_monthly', document.getElementById('set-price-monthly').value);
            saveSetting('price_yearly', document.getElementById('set-price-yearly').value);
        }

        // â•â•â• Init â•â•â•
        document.addEventListener('DOMContentLoaded', checkAdmin);
    </script>
</body>
</html>
