<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ุงุฎุชูุงุฑ ุงููุณู - ูุณุงุฑู</title>

  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

  <style>
    body { font-family: 'Tajawal', sans-serif; }
  </style>
</head>

<body class="bg-slate-50 min-h-screen">

  <!-- Header -->
  <header class="bg-white border-b">
    <div class="max-w-6xl mx-auto px-4 py-4 flex items-center justify-between">
      <h1 class="text-xl font-bold text-slate-800">ุงุฎุชุฑ ุงููุณู</h1>
      <a href="dashboard.html" class="text-slate-600 hover:text-slate-900 font-medium">
        โ ุงูุนูุฏุฉ ูููุญุฉ
      </a>
    </div>
  </header>

  <main class="max-w-6xl mx-auto px-4 py-10">
    <div class="text-center mb-10">
      <h2 class="text-4xl font-extrabold text-slate-900 mb-3">ุงุฎุชุฑ ุงููุณู ููุชุฏุฑูุจ</h2>
      <p class="text-slate-600 text-lg">ุงุจุฏุฃ ุงูุชุฏุฑูุจ ูุจุงุดุฑุฉ ุญุณุจ ุงููุณู</p>
    </div>

    <!-- Cards -->
    <div class="grid grid-cols-1 md:grid-cols-3 gap-6">

      <!-- ุชุญุตููู -->
      <div class="bg-white rounded-2xl shadow-sm border border-purple-200 p-6">
        <div class="flex items-center gap-3 mb-4">
          <div class="w-12 h-12 rounded-xl bg-purple-600 flex items-center justify-center text-white text-2xl">๐</div>
          <div>
            <h3 class="text-2xl font-bold text-slate-900">ุงูุชุญุตููู</h3>
            <p class="text-slate-600">ุงูููุงุฏ ุงูุฏุฑุงุณูุฉ</p>
          </div>
        </div>

        <ul class="text-slate-700 space-y-2 mb-5">
          <li>โ ุงูุฑูุงุถูุงุช</li>
          <li>โ ุงูููุฒูุงุก</li>
          <li>โ ุงูููููุงุก</li>
          <li>โ ุงูุฃุญูุงุก</li>
        </ul>

        <div class="rounded-xl bg-purple-50 border border-purple-100 p-3 text-center mb-3">
          <span id="achievementCount" class="font-bold text-purple-700">ุฌุงุฑู ุงูุชุญููู...</span>
        </div>

        <button id="achievementBtn"
                class="w-full py-3 rounded-xl font-bold bg-purple-600 text-white hover:bg-purple-700 disabled:bg-slate-300 disabled:text-slate-600 disabled:cursor-not-allowed"
                disabled>
          ุฌุงุฑู ุงูุชุญููู...
        </button>
      </div>

      <!-- ูุฏุฑุงุช ููุธู -->
      <div class="bg-white rounded-2xl shadow-sm border border-green-200 p-6">
        <div class="flex items-center gap-3 mb-4">
          <div class="w-12 h-12 rounded-xl bg-green-600 flex items-center justify-center text-white text-2xl">๐</div>
          <div>
            <h3 class="text-2xl font-bold text-slate-900">ูุฏุฑุงุช ููุธู</h3>
            <p class="text-slate-600">ุงููุบุฉ ุงูุนุฑุจูุฉ</p>
          </div>
        </div>

        <ul class="text-slate-700 space-y-2 mb-5">
          <li>โ ุงูุชูุงุธุฑ ุงูููุธู</li>
          <li>โ ุฅููุงู ุงูุฌูู</li>
          <li>โ ุงูุฎุทุฃ ุงูุณูุงูู</li>
          <li>โ ุงูุงุณุชูุนุงุจ ุงูููุฑูุก</li>
        </ul>

        <div class="rounded-xl bg-green-50 border border-green-100 p-3 text-center mb-3">
          <span id="verbalCount" class="font-bold text-green-700">ุฌุงุฑู ุงูุชุญููู...</span>
        </div>

        <button id="verbalBtn"
                class="w-full py-3 rounded-xl font-bold bg-green-600 text-white hover:bg-green-700 disabled:bg-slate-300 disabled:text-slate-600 disabled:cursor-not-allowed"
                disabled>
          ุฌุงุฑู ุงูุชุญููู...
        </button>
      </div>

      <!-- ูุฏุฑุงุช ููู -->
      <div class="bg-white rounded-2xl shadow-sm border border-blue-200 p-6">
        <div class="flex items-center gap-3 mb-4">
          <div class="w-12 h-12 rounded-xl bg-blue-600 flex items-center justify-center text-white text-2xl">๐</div>
          <div>
            <h3 class="text-2xl font-bold text-slate-900">ูุฏุฑุงุช ููู</h3>
            <p class="text-slate-600">ุงูุฑูุงุถูุงุช ูุงูุญุณุงุจ</p>
          </div>
        </div>

        <ul class="text-slate-700 space-y-2 mb-5">
          <li>โ ุงูุฌุจุฑ ูุงููุนุงุฏูุงุช</li>
          <li>โ ุงูููุฏุณุฉ</li>
          <li>โ ุงููุณุจุฉ ูุงูุชูุงุณุจ</li>
          <li>โ ุงูุฅุญุตุงุก</li>
        </ul>

        <div class="rounded-xl bg-blue-50 border border-blue-100 p-3 text-center mb-3">
          <span id="quantitativeCount" class="font-bold text-blue-700">ุฌุงุฑู ุงูุชุญููู...</span>
        </div>

        <button id="quantitativeBtn"
                class="w-full py-3 rounded-xl font-bold bg-blue-600 text-white hover:bg-blue-700 disabled:bg-slate-300 disabled:text-slate-600 disabled:cursor-not-allowed"
                disabled>
          ุฌุงุฑู ุงูุชุญููู...
        </button>
      </div>

    </div>

    <div class="mt-8 text-center">
      <div id="errBox" class="hidden inline-block bg-red-50 border border-red-200 text-red-800 px-4 py-3 rounded-xl text-sm"></div>
    </div>

  </main>

  <script>
    // โ ููุณ ูุดุฑูุนู (Supabase)
    const sb = window.supabase.createClient(
      'https://czzcmbxejxbotjemyuqf.supabase.co',
      'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImN6emNtYnhlanhib3RqZW15dXFmIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzAxNzQ0ODEsImV4cCI6MjA4NTc1MDQ4MX0.xDfG1qsDZGyUrpL44JfqOtk57dVsLaMsvIzJz1KgiR0'
    );

    function showErr(msg) {
      const box = document.getElementById('errBox');
      box.textContent = msg;
      box.classList.remove('hidden');
    }

    async function requireAuth() {
      // ูู ุชุจู ุชุฎูู ุงูุตูุญุฉ ุจุฏูู ุชุณุฌูู ุฏุฎููุ ุงุญุฐู ูุงูุฏุงูุฉ ูุงุณุชุฏุนุงุกูุง
      const { data: { session }, error } = await sb.auth.getSession();
      if (error) console.warn(error);
      if (!session) {
        window.location.href = 'login.html';
        return null;
      }
      return session;
    }

    async function loadQuestionCounts() {
      const mapping = {
        quantitative: 'ูุฏุฑุงุช ููู',
        verbal: 'ูุฏุฑุงุช ููุธู',
        achievement: 'ุชุญุตููู'
      };

      for (const [key, subjectName] of Object.entries(mapping)) {
        const countEl = document.getElementById(`${key}Count`);
        const btnEl = document.getElementById(`${key}Btn`);

        countEl.textContent = 'ุฌุงุฑู ุงูุชุญููู...';
        btnEl.disabled = true;
        btnEl.textContent = 'ุฌุงุฑู ุงูุชุญููู...';

        const { data, error } = await sb
          .from('questions')
          .select('id', { count: 'exact', head: true })
          .eq('subject', subjectName);

        if (error) {
          console.error(error);
          countEl.textContent = 'ุชุนุฐุฑ ุฌูุจ ุงูุฃุณุฆูุฉ';
          btnEl.textContent = 'ุชุนุฐุฑ ุงูุชุญููู';
          continue;
        }

        // ูุฃููุง ุงุณุชุฎุฏููุง head:trueุ data ุบุงูุจุงู nullุ ูุญุชุงุฌ count ูู response
        // supabase-js ูุนูุฏ count ุฏุงุฎู ููุณ responseุ ููู ุจุนุถ ุงูุฅุตุฏุงุฑุงุช ุชุญุชุงุฌ .select('*', {count:'exact'}) ุจุฏูู head
        // ุนุดุงู ูุถูู 100%ุ ูุนูุฏ ุทูุจ ุจุณูุท ุจุฏูู head ุฅุฐุง count ุบูุฑ ูุชููุฑ.
        let count = 0;
        // ูุญุงููุฉ ุงุณุชุฎุฑุงุฌ count ุจุทุฑููุฉ ุขููุฉ:
        // ูู ุจุนุถ ุงูุญุงูุงุช count ูุฌู ุถูู properties ุบูุฑ ุธุงูุฑุฉ ููุง. ูุฐูู ูุนูุฏ ุงุณุชุนูุงู ูุถููู:
        const fallback = await sb
          .from('questions')
          .select('id')
          .eq('subject', subjectName);

        if (fallback.error) {
          console.error(fallback.error);
          countEl.textContent = 'ุชุนุฐุฑ ุฌูุจ ุงูุฃุณุฆูุฉ';
          btnEl.textContent = 'ุชุนุฐุฑ ุงูุชุญููู';
          continue;
        }

        count = (fallback.data || []).length;

        countEl.textContent = `${count} ุณุคุงู ูุชุงุญ`;

        if (count > 0) {
          btnEl.disabled = false;
          btnEl.textContent = 'ุงุจุฏุฃ ุงูุชุฏุฑูุจ';
          btnEl.onclick = () => startTraining(subjectName);
        } else {
          btnEl.disabled = true;
          btnEl.textContent = 'ูุง ููุฌุฏ ุฃุณุฆูุฉ ุงูุขู';
          btnEl.onclick = null;
        }
      }
    }

    function startTraining(subjectName) {
      // ูุฎุฒู ุงุฎุชูุงุฑ ุงูุทุงูุจ
      localStorage.setItem('masari_selected_subject', subjectName);

      // ุฅุฐุง ุนูุฏู ุงุฎุชูุงุฑ "section" ุชูุตููู ูุงุญูุงู ุงุณุชุฎุฏู select-section ุฏุงุฎูู
      // ุญุงููุงู ูุฑุณู ููุชุฏุฑูุจ ูุจุงุดุฑุฉ
      window.location.href = 'practice.html';
    }

    (async function init() {
      await requireAuth(); // ุงุญุฐููุง ุฅุฐุง ุชุจู ุจุฏูู ุชุณุฌูู ุฏุฎูู
      await loadQuestionCounts();
    })();
  </script>

</body>
</html>
