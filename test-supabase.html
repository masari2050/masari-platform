<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø§Ø®ØªØ¨Ø§Ø± Supabase</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            background: #f5f5f5;
        }
        .box {
            background: white;
            padding: 20px;
            margin: 10px 0;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .success { color: green; }
        .error { color: red; }
        .info { color: blue; }
        pre {
            background: #f0f0f0;
            padding: 10px;
            border-radius: 4px;
            overflow-x: auto;
        }
    </style>
</head>
<body>
    <h1>ğŸ” Ø§Ø®ØªØ¨Ø§Ø± Ø§ØªØµØ§Ù„ Supabase</h1>
    
    <div class="box">
        <h2>1ï¸âƒ£ Ø­Ø§Ù„Ø© Ø§Ù„Ø§ØªØµØ§Ù„</h2>
        <p id="connectionStatus">Ø¬Ø§Ø±ÙŠ Ø§Ù„ÙØ­Øµ...</p>
    </div>

    <div class="box">
        <h2>2ï¸âƒ£ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</h2>
        <p id="userInfo">Ø¬Ø§Ø±ÙŠ Ø§Ù„ÙØ­Øµ...</p>
    </div>

    <div class="box">
        <h2>3ï¸âƒ£ Ø¬Ù„Ø¨ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø§Øª Ù…Ù† Ø¬Ø¯ÙˆÙ„ attempts</h2>
        <p id="attemptsStatus">Ø¬Ø§Ø±ÙŠ Ø§Ù„ÙØ­Øµ...</p>
        <pre id="attemptsData"></pre>
    </div>

    <div class="box">
        <h2>4ï¸âƒ£ Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ù…Ø­Ø³ÙˆØ¨Ø©</h2>
        <pre id="statsData"></pre>
    </div>

    <button onclick="runTest()" style="padding: 10px 20px; font-size: 16px; cursor: pointer;">
        ğŸ”„ Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±
    </button>

    <script>
        const supabaseUrl = 'https://czzcmbxejxbotjemyuqf.supabase.co';
        const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImN6emNtYnhlanhib3RqZW15dXFmIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzAxNzQ0ODEsImV4cCI6MjA4NTc1MDQ4MX0.xDfG1qsDZGyUrpL44JfqOtk57dVsLaMsvIzJz1KgiR0';
        const sb = window.supabase.createClient(supabaseUrl, supabaseKey);

        async function runTest() {
            console.log('ğŸš€ Ø¨Ø¯Ø¡ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±...');
            
            // 1. ÙØ­Øµ Ø§Ù„Ø§ØªØµØ§Ù„
            try {
                document.getElementById('connectionStatus').innerHTML = '<span class="info">Ø¬Ø§Ø±ÙŠ Ø§Ù„ÙØ­Øµ...</span>';
                
                const { data, error } = await sb.from('attempts').select('count').limit(1);
                if (error) throw error;
                
                document.getElementById('connectionStatus').innerHTML = '<span class="success">âœ… Ø§Ù„Ø§ØªØµØ§Ù„ Ù†Ø§Ø¬Ø­!</span>';
            } catch (err) {
                document.getElementById('connectionStatus').innerHTML = `<span class="error">âŒ ÙØ´Ù„ Ø§Ù„Ø§ØªØµØ§Ù„: ${err.message}</span>`;
                return;
            }

            // 2. ÙØ­Øµ Ø§Ù„Ø¬Ù„Ø³Ø©
            try {
                const { data: { session }, error } = await sb.auth.getSession();
                
                if (error || !session) {
                    document.getElementById('userInfo').innerHTML = '<span class="error">âŒ Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¬Ù„Ø³Ø© Ù†Ø´Ø·Ø© - Ø§Ù„Ø±Ø¬Ø§Ø¡ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø£ÙˆÙ„Ø§Ù‹</span>';
                    return;
                }
                
                const userId = session.user.id;
                const userEmail = session.user.email;
                
                document.getElementById('userInfo').innerHTML = `
                    <span class="success">âœ… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù…Ø³Ø¬Ù„ Ø¯Ø®ÙˆÙ„</span><br>
                    <strong>User ID:</strong> ${userId}<br>
                    <strong>Email:</strong> ${userEmail}
                `;
                
                // 3. Ø¬Ù„Ø¨ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø§Øª
                console.log('ğŸ“Š Ø¬Ù„Ø¨ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø§Øª Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù…:', userId);
                
                const { data: attempts, error: attemptsError } = await sb
                    .from('attempts')
                    .select('*')
                    .eq('user_id', userId);
                
                if (attemptsError) {
                    document.getElementById('attemptsStatus').innerHTML = `<span class="error">âŒ Ø®Ø·Ø£: ${attemptsError.message}</span>`;
                    document.getElementById('attemptsData').textContent = JSON.stringify(attemptsError, null, 2);
                    return;
                }
                
                document.getElementById('attemptsStatus').innerHTML = `<span class="success">âœ… ØªÙ… Ø¬Ù„Ø¨ ${attempts ? attempts.length : 0} Ù…Ø­Ø§ÙˆÙ„Ø©</span>`;
                document.getElementById('attemptsData').textContent = JSON.stringify(attempts, null, 2);
                
                // 4. Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª
                if (attempts && attempts.length > 0) {
                    const total = attempts.length;
                    const correct = attempts.filter(a => a.is_correct).length;
                    const wrong = total - correct;
                    const rate = Math.round((correct / total) * 100);
                    
                    const stats = {
                        'Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø£Ø³Ø¦Ù„Ø©': total,
                        'Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø§Øª Ø§Ù„ØµØ­ÙŠØ­Ø©': correct,
                        'Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø§Øª Ø§Ù„Ø®Ø§Ø·Ø¦Ø©': wrong,
                        'Ù†Ø³Ø¨Ø© Ø§Ù„Ù†Ø¬Ø§Ø­': rate + '%'
                    };
                    
                    document.getElementById('statsData').textContent = JSON.stringify(stats, null, 2);
                } else {
                    document.getElementById('statsData').textContent = 'Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø­Ø§ÙˆÙ„Ø§Øª';
                }
                
            } catch (err) {
                console.error('âŒ Ø®Ø·Ø£:', err);
                document.getElementById('userInfo').innerHTML = `<span class="error">âŒ Ø®Ø·Ø£: ${err.message}</span>`;
            }
        }

        // ØªØ´ØºÙŠÙ„ ØªÙ„Ù‚Ø§Ø¦ÙŠ Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
        window.addEventListener('DOMContentLoaded', runTest);
    </script>
</body>
</html>
